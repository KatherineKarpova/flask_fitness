{% extends "layout.html" %}

{% block title %}
    Edit a Routine
{% endblock %}

{% block main %}
<!-- Main form container -->
<form id="edit-routine-form" action="/editRoutine" method="post">
    <!-- Routine select container -->
    <div id="routine-select-container">
        <label for="routine-select">Select a Routine</label>
        <select id="routine-select" name="selected-routine-name" placeholder="routine-name" class="routine-select"></select>
            <!-- Routine options will be populated by JavaScript -->
        </select>
    </div>
    
    <!-- Routine name input (for editing) -->
    <input type="text" id="edit-routine-name" name="edit-routine-name" placeholder="Enter routine name" class="long-input">
    <div id="edit-routine-container"></div>
    <div id="add-exercise-container"></div>
    <button type="button" id="add-exercise">Add Exercise</button>
    <button type="submit" name="action" value="update">Update</button>
    <button type="button" id="delete-button">Delete</button>
    <div id="delete-confirmation" style="display:none;">
        <p>Are you sure you want to delete this routine?</p>
        <button type="submit" name="action" value="delete" class="btn btn-danger">Confirm Delete</button>
        <button type="button" id="cancel-button" class="btn btn-secondary">Cancel</button>
    </div>
</form>

<script>
    // This function runs when the window is loaded
    window.onload = function() {
        // Call these functions to populate routine select dropdown and get available routines
        getRoutines();
    };

    // Wait for the DOM to be fully loaded before executing JS
    document.addEventListener("DOMContentLoaded", function() {
        addExerciseSetsEvent();
        deleteRoutineEvent(); // Call the delete button handler here
        document.getElementById("routine-select").addEventListener("change", function() {
        console.log("Routine selected");

        const selectedRoutine = this.value;  // Get the value of the selected routine

        // Clear the previous form data by resetting the "edit-routine-container"
        const routineContainer = document.getElementById("edit-routine-container");
        routineContainer.innerHTML = '';  // Clears all child elements (inputs, etc.)

        // Clear the routine name input field
        document.getElementById("edit-routine-name").value = '';  // Reset to empty

        if (selectedRoutine) {
            // Pre-fill the routine name input field with the selected routine name
            document.getElementById("edit-routine-name").value = selectedRoutine;

            // Fetch the routine data when a routine is selected
            getRoutineData(selectedRoutine)
                .then(routineData => {
                // Once data is fetched, generate the form for editing exercises
                    editRoutineForm("edit-routine-container", routineData);
                })
                .catch(error => {
                    console.error("Error loading routine data:", error);
                });
        }
    });
});


</script>

{% endblock %}
